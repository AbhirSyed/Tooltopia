{% extends "base.html" %}
{% block title %}Homepage{% endblock %}
{% block content %}
<h1>Products</h1>
{% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul>
    {% for message in messages %}
      <li>{{ message }}</li>
    {% endfor %}
    </ul>
  {% endif %}
{% endwith %}
<div class="product-grid">
    {% for product in products %}
    <div class="product">
        <a href="{{ url_for('product_detail', product_id=product.id) }}">
            <img src="{{ url_for('static', filename=product.image) }}" alt="{{ product.name }}">
        </a>
        <h3>{{ product.name }}</h3>
        <p>Â£{{ product.price }}</p>
        <button class="add-to-cart" data-product-id="{{ product.id }}">Add to Cart</button>
    </div>
    {% endfor %}
</div>
<div id="cart-notification" style="display: none;">Product added to cart!</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var addToCartButtons = document.querySelectorAll('.add-to-cart');
        addToCartButtons.forEach(function(button) {
            button.addEventListener('click', function() {
                var productId = button.dataset.productId;
                var xhr = new XMLHttpRequest();
                xhr.open('POST', '/add_to_cart');
                xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                xhr.onload = function() {
                    if (xhr.status === 200) {
                        var notification = document.getElementById('cart-notification');
                        notification.style.display = 'block';
                        setTimeout(function() {
                            notification.style.display = 'none';
                        }, 3000);
                    }
                };
                xhr.send('product_id=' + productId);
            });
        });
    });
    </script>
    
{% endblock %}
